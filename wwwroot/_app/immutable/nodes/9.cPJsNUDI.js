import{a as d,f as b,t as L,c as ts}from"../chunks/D__f5P3N.js";import"../chunks/DYHuzUNG.js";import{p as as,D as M,J as os,a as ns,w as e,G as is,C as v,c as x,s as c,f as S,F as U,t as W,r as C}from"../chunks/DJxnAQxZ.js";import{d as ls,c as ds,B as cs,b as us}from"../chunks/BE4kj85j.js";import{m as fs}from"../chunks/CSUflvoX.js";import{s as ms}from"../chunks/CKTSjATE.js";import{r as ps,i as vs}from"../chunks/JpLCEfp9.js";import{c as w}from"../chunks/C3L73MzT.js";import{r as V,a as I,b as q,I as z,H as K,c as ws,F as gs,d as $s}from"../chunks/C8kaujdF.js";import{p as Ps}from"../chunks/C7fXCa3B.js";import{c as _s,a as hs,A as bs,t as Q}from"../chunks/KB_K6DwI.js";import{g as xs}from"../chunks/DxqAJtII.js";import{S as Cs}from"../chunks/D57HcRkC.js";var Ns=b("<!> <!> <!>",1),ys=b("<!> <!> <!>",1),ks=b("<!> ",1),Fs=b('<a href="/login">Back to log in</a>'),Ss=b('<div class="flex flex-col items-center gap-1 text-center"><h1 class="text-2xl font-bold">Reset password</h1></div> <!> <!> <!> <!>',1),Bs=b("<form><!></form>");function js(O,g){as(g,!0);let N=ps(g,["$$slots","$$events","$$legacy","class"]),y=Ps.url.searchParams,k=v(()=>y.get("tkn")),B=v(()=>y.get("email")),o=M({NewPassword:"",PasswordConfirm:""}),t=os(M({})),j=M({});function T(s){const f=$s.pick({[s]:!0}).safeParse({[s]:o[s]});f.success?delete e(t)[s]:e(t)[s]=f.error.issues[0].message}function X(){const s=V.safeParse(o),u=s.success?null:s.error.issues.find(f=>f.path[0]==="PasswordConfirm");u?e(t).PasswordConfirm=u.message:delete e(t).PasswordConfirm}function Y(s){j[s]=!0,T(s)}let R=_s(()=>({mutationFn:async s=>hs(`${bs}/api/auth/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}));async function Z(s){if(s.preventDefault(),!e(k)){Q.error("No token found",{richColors:!0});return}Object.keys(o).forEach($=>j[$]=!0);const u=V.safeParse(o);if(!u.success){is(t,Object.fromEntries(u.error.issues.map($=>[$.path[0],$.message])),!0);return}const f={NewPassword:u.data.NewPassword,PasswordVerificationToken:e(k)},H=await R.mutateAsync(f);Q.success(H.message,{richColors:!0});let F="/login";e(B)&&(F+=`?email=${e(B)}`),xs(F)}var A=Bs();ls(A,s=>({onsubmit:Z,class:s,...N}),[()=>ds("flex flex-col gap-6",g.class)]);var ss=x(A);w(ss,()=>gs,(s,u)=>{u(s,{children:(f,H)=>{var F=Ss(),$=c(S(F),2);w($,()=>I,(P,_)=>{_(P,{children:(h,D)=>{var i=Ns(),m=S(i);w(m,()=>q,(r,a)=>{a(r,{for:"NewPassword",children:(n,rs)=>{U();var E=L("New password");d(n,E)},$$slots:{default:!0}})});var l=c(m,2);{let r=v(()=>Y.bind(null,"NewPassword")),a=v(()=>`${e(t)?.NewPassword?"border-destructive":""}`);z(l,{id:"NewPassword",get onblur(){return e(r)},oninput:()=>j.NewPassword&&T("NewPassword"),get class(){return e(a)},type:"password",get value(){return o.NewPassword},set value(n){o.NewPassword=n}})}var p=c(l,2);{let r=v(()=>e(t)?.NewPassword?"error":"info");K(p,{get variant(){return e(r)},message:"Must be at least 8 characters long."})}d(h,i)},$$slots:{default:!0}})});var J=c($,2);w(J,()=>I,(P,_)=>{_(P,{children:(h,D)=>{var i=ys(),m=S(i);w(m,()=>q,(r,a)=>{a(r,{for:"passwordConfirm",children:(n,rs)=>{U();var E=L("Confirm password");d(n,E)},$$slots:{default:!0}})});var l=c(m,2);{let r=v(()=>`${e(t)?.PasswordConfirm?"border-destructive":""}`);z(l,{id:"passwordConfirm",get class(){return e(r)},onblur:X,oninput:()=>j.PasswordConfirm&&T("PasswordConfirm"),type:"password",get value(){return o.PasswordConfirm},set value(a){o.PasswordConfirm=a}})}var p=c(l,2);{let r=v(()=>e(t)?.PasswordConfirm||""),a=v(()=>!!e(t)?.PasswordConfirm);K(p,{variant:"error",get message(){return e(r)},get show(){return e(a)}})}d(h,i)},$$slots:{default:!0}})});var G=c(J,2);w(G,()=>I,(P,_)=>{_(P,{children:(h,D)=>{cs(h,{get disabled(){return R.isPending},type:"submit",children:(i,m)=>{var l=ks(),p=S(l);{var r=n=>{Cs(n,{})};vs(p,n=>{R.isPending&&n(r)})}var a=c(p);W(()=>ms(a,` ${R.isPending?"Resetting password...":"Reset password"}`)),d(i,l)},$$slots:{default:!0}})},$$slots:{default:!0}})});var es=c(G,2);w(es,()=>I,(P,_)=>{_(P,{children:(h,D)=>{var i=ts(),m=S(i);w(m,()=>ws,(l,p)=>{p(l,{class:"px-6 text-center",children:(r,a)=>{var n=Fs();d(r,n)},$$slots:{default:!0}})}),d(h,i)},$$slots:{default:!0}})}),d(f,F)},$$slots:{default:!0}})}),C(A),d(O,A),ns()}var Rs=b('<div class="grid min-h-svh lg:grid-cols-2"><div class="flex flex-col gap-4 p-6 md:p-10"><div class="flex flex-1 items-center justify-center"><div class="w-full max-w-xs"><!></div></div></div> <div class="relative hidden bg-muted lg:block"><img alt="placeholder" class="absolute inset-0 h-full w-full object-cover dark:brightness-[0.8] dark:grayscale"/></div></div>');function qs(O){var g=Rs(),N=x(g),y=x(N),k=x(y),B=x(k);js(B,{}),C(k),C(y),C(N);var o=c(N,2),t=x(o);C(o),C(g),W(()=>us(t,"src",fs)),d(O,g)}export{qs as component};
