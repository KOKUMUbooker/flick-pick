import{a as d,f as b,r as ts,t as K,i as as,d as os}from"../chunks/i2qjbZCX.js";import"../chunks/0TDw33Fi.js";import{p as ns,K as D,L as ls,b as is,g as e,s as ds,J as v,c as x,e as c,f as S,n as U,t as W,r as C}from"../chunks/BjJVWsSe.js";import{d as cs,c as us,B as fs,b as ms}from"../chunks/BCgBbjUq.js";import{m as ps}from"../chunks/CSUflvoX.js";import{s as vs}from"../chunks/BCxAJUJy.js";import{c as w}from"../chunks/DlPwGvb5.js";import{r as V,a as I,b as q,I as z,H as G,c as ws,F as gs,d as $s}from"../chunks/DwCgtXDN.js";import{p as Ps}from"../chunks/8BGKzr_V.js";import{c as _s,a as hs,A as bs,t as Q}from"../chunks/qcaP-jiJ.js";import{g as xs}from"../chunks/CwPZXjMm.js";import{S as Cs}from"../chunks/K6lY8tZ2.js";var Ns=b("<!> <!> <!>",1),ys=b("<!> <!> <!>",1),ks=b("<!> ",1),Fs=b('<a href="/login">Back to log in</a>'),Ss=b('<div class="flex flex-col items-center gap-1 text-center"><h1 class="text-2xl font-bold">Reset password</h1></div> <!> <!> <!> <!>',1),Bs=b("<form><!></form>");function js(O,g){ns(g,!0);let N=ts(g,["$$slots","$$events","$$legacy","class"]),y=Ps.url.searchParams,k=v(()=>y.get("tkn")),B=v(()=>y.get("email")),o=D({NewPassword:"",PasswordConfirm:""}),t=ls(D({})),j=D({});function T(s){const f=$s.pick({[s]:!0}).safeParse({[s]:o[s]});f.success?delete e(t)[s]:e(t)[s]=f.error.issues[0].message}function X(){const s=V.safeParse(o),u=s.success?null:s.error.issues.find(f=>f.path[0]==="PasswordConfirm");u?e(t).PasswordConfirm=u.message:delete e(t).PasswordConfirm}function Y(s){j[s]=!0,T(s)}let R=_s(()=>({mutationFn:async s=>hs(`${bs}/api/auth/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})}));async function Z(s){if(s.preventDefault(),!e(k)){Q.error("No token found",{richColors:!0});return}Object.keys(o).forEach($=>j[$]=!0);const u=V.safeParse(o);if(!u.success){ds(t,Object.fromEntries(u.error.issues.map($=>[$.path[0],$.message])),!0);return}const f={NewPassword:u.data.NewPassword,PasswordVerificationToken:e(k)},H=await R.mutateAsync(f);Q.success(H.message,{richColors:!0});let F="/login";e(B)&&(F+=`?email=${e(B)}`),xs(F)}var A=Bs();cs(A,s=>({onsubmit:Z,class:s,...N}),[()=>us("flex flex-col gap-6",g.class)]);var ss=x(A);w(ss,()=>gs,(s,u)=>{u(s,{children:(f,H)=>{var F=Ss(),$=c(S(F),2);w($,()=>I,(P,_)=>{_(P,{children:(h,E)=>{var l=Ns(),m=S(l);w(m,()=>q,(r,a)=>{a(r,{for:"NewPassword",children:(n,rs)=>{U();var M=K("New password");d(n,M)},$$slots:{default:!0}})});var i=c(m,2);{let r=v(()=>Y.bind(null,"NewPassword")),a=v(()=>`${e(t)?.NewPassword?"border-destructive":""}`);z(i,{id:"NewPassword",get onblur(){return e(r)},oninput:()=>j.NewPassword&&T("NewPassword"),get class(){return e(a)},type:"password",get value(){return o.NewPassword},set value(n){o.NewPassword=n}})}var p=c(i,2);{let r=v(()=>e(t)?.NewPassword?"error":"info");G(p,{get variant(){return e(r)},message:"Must be at least 8 characters long."})}d(h,l)},$$slots:{default:!0}})});var J=c($,2);w(J,()=>I,(P,_)=>{_(P,{children:(h,E)=>{var l=ys(),m=S(l);w(m,()=>q,(r,a)=>{a(r,{for:"passwordConfirm",children:(n,rs)=>{U();var M=K("Confirm password");d(n,M)},$$slots:{default:!0}})});var i=c(m,2);{let r=v(()=>`${e(t)?.PasswordConfirm?"border-destructive":""}`);z(i,{id:"passwordConfirm",get class(){return e(r)},onblur:X,oninput:()=>j.PasswordConfirm&&T("PasswordConfirm"),type:"password",get value(){return o.PasswordConfirm},set value(a){o.PasswordConfirm=a}})}var p=c(i,2);{let r=v(()=>e(t)?.PasswordConfirm||""),a=v(()=>!!e(t)?.PasswordConfirm);G(p,{variant:"error",get message(){return e(r)},get show(){return e(a)}})}d(h,l)},$$slots:{default:!0}})});var L=c(J,2);w(L,()=>I,(P,_)=>{_(P,{children:(h,E)=>{fs(h,{get disabled(){return R.isPending},type:"submit",children:(l,m)=>{var i=ks(),p=S(i);{var r=n=>{Cs(n,{})};as(p,n=>{R.isPending&&n(r)})}var a=c(p);W(()=>vs(a,` ${R.isPending?"Resetting password...":"Reset password"}`)),d(l,i)},$$slots:{default:!0}})},$$slots:{default:!0}})});var es=c(L,2);w(es,()=>I,(P,_)=>{_(P,{children:(h,E)=>{var l=os(),m=S(l);w(m,()=>ws,(i,p)=>{p(i,{class:"px-6 text-center",children:(r,a)=>{var n=Fs();d(r,n)},$$slots:{default:!0}})}),d(h,l)},$$slots:{default:!0}})}),d(f,F)},$$slots:{default:!0}})}),C(A),d(O,A),is()}var Rs=b('<div class="grid min-h-svh lg:grid-cols-2"><div class="flex flex-col gap-4 p-6 md:p-10"><div class="flex flex-1 items-center justify-center"><div class="w-full max-w-xs"><!></div></div></div> <div class="relative hidden bg-muted lg:block"><img alt="placeholder" class="absolute inset-0 h-full w-full object-cover dark:brightness-[0.8] dark:grayscale"/></div></div>');function Vs(O){var g=Rs(),N=x(g),y=x(N),k=x(y),B=x(k);js(B,{}),C(k),C(y),C(N);var o=c(N,2),t=x(o);C(o),C(g),W(()=>ms(t,"src",ps)),d(O,g)}export{Vs as component};
